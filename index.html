<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¬ è§†é¢‘æ’­æ”¾é¡µ</title>
<style>
  body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }
  video {
    width: 100%;
    max-width: 400px;
    background: #000;
    border-radius: 8px;
  }
  #overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: #fff;
  }
  #overlay img {
    width: 180px;
    height: 180px;
    margin-bottom: 15px;
  }
  #shareBtn {
    background: #0af;
    padding: 10px 20px;
    border-radius: 6px;
    margin-top: 10px;
    color: #fff;
    border: none;
  }
</style>
</head>
<body>
<video id="player" controls poster="cover.jpg" preload="auto"></video>

<div id="overlay">
  <img src="qr.jpg" alt="åˆ†äº«äºŒç»´ç ">
  <p>è¯·åˆ†äº«åˆ°å¾®ä¿¡ç¾¤ï¼Œåœç•™ 10 ç§’åæ–¹å¯ç»§ç»­æ’­æ”¾</p>
  <button id="shareBtn" disabled>æˆ‘å·²åˆ†äº«</button>
</div>

<script>
let player = document.getElementById('player');
let overlay = document.getElementById('overlay');
let shareBtn = document.getElementById('shareBtn');

// ä» JSON åŠ è½½è§†é¢‘åˆ—è¡¨
fetch('links.json?t=' + Date.now())
  .then(res => res.json())
  .then(data => {
    let current = localStorage.getItem('lastVideo') || 0;
    player.src = data[current];
    player.play();
  });

// æ’­æ”¾è®¡æ•°é€»è¾‘
player.addEventListener('play', () => {
  let watched = JSON.parse(localStorage.getItem('watched') || '[]');
  let src = player.src;
  if (!watched.includes(src)) {
    watched.push(src);
    localStorage.setItem('watched', JSON.stringify(watched));

    if (watched.length % 3 === 0) {
      player.pause();
      overlay.style.display = 'flex';
      let timer = 10;
      shareBtn.innerText = 'è¯·ç­‰å¾… ' + timer + ' ç§’...';
      let countdown = setInterval(() => {
        timer--;
        shareBtn.innerText = timer > 0 ? 'è¯·ç­‰å¾… ' + timer + ' ç§’...' : 'æˆ‘å·²åˆ†äº«';
        if (timer <= 0) {
          clearInterval(countdown);
          shareBtn.disabled = false;
        }
      }, 1000);
    }
  }
});

shareBtn.addEventListener('click', () => {
  overlay.style.display = 'none';
  player.play();
});

// è®°å¿†æ’­æ”¾ä½ç½®
player.addEventListener('timeupdate', () => {
  localStorage.setItem('lastTime', player.currentTime);
});
player.addEventListener('loadedmetadata', () => {
  const t = localStorage.getItem('lastTime');
  if (t) player.currentTime = t;
});
</script>
</body>
</html>
